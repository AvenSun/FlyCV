<!doctype html>
<html>
<style>
    img { width: 300px; }
</style>
<body>
    <img src="../../data/test_sunrise.jpg" id="source_img">
    <canvas id="target_img"></canvas>
    <script src="../../../flycv.js" type="text/javascript"></script>
    <script type="text/javascript">
        fcv.then((fcv) => {
            let srcRgba = fcv.imread("source_img");
            let srcBgr = new fcv.Mat();
            let mask = new fcv.Mat(srcRgba.width(), srcRgba.height(), fcv.FCVImageType.GRAY_U8);
            let dst = new fcv.Mat();

            let mask_data = [];
            for (let i = 0; i < mask.width() * mask.height(); i++) {
                mask_data.push(i * 2 % 256);
            }
            mask.data().set(mask_data);

            fcv.cvtColor(srcRgba, srcBgr, fcv.ColorConvertType.CVT_PA_RGBA2PA_BGR);
            fcv.bgrToRgbaWithMask(srcBgr, mask, dst);
            fcv.imshow("target_img", dst);

            srcRgba.delete();
            srcBgr.delete();
            mask.delete();
            dst.delete();
        });
    </script>
</body>
</html>